function Foltmeter(t){function e(){r(),l(t);var e,n=0,a=0,u=[],d=0;O=t.data[t.data.length-1],t.textColor=t.textColor?t.textColor:"#455A64",t.data.map(function(e,n){d=t.data[n-1]||0,u.push([0,e-d])}),D=d3.select(t.selector),D.selectAll("svg").remove(),y=d3.svg.arc().innerRadius(t.radii[0]).outerRadius(t.radii[1]),b=D.append("svg").attr("height",M).attr("width",S),C=b.append("g").attr("transform","translate("+S/2+","+M/2+")"),V=b.append("g").attr("transform","translate("+S/2+","+M/2+")"),t.showPercentage&&(L=b.append("text").attr("fill",t.textColor).attr("style","font-size: 20px;").attr("dy","20px").text("0").attr("text-anchor","middle").attr("x",function(){return S/2-this.getBBox().width+3}).attr("y",function(){return M/2-this.getBBox().height/2}),b.append("text").attr("fill",t.textColor).attr("style","font-size: 20px;").attr("dy","20px").text("%").attr("text-anchor","middle").attr("x",function(){return S/2+this.getBBox().width}).attr("y",function(){return M/2-this.getBBox().height/2})),C.selectAll("path").data(i(t.ranges,u)).enter().append("path").attr("fill",t.colors[0]).attr("d",y).each(function(){I.push(this.getTotalLength())}),V.selectAll("path").data(o(t.ranges,u)).enter().append("path").attr("fill",t.colors[1]).attr("d",y).each(function(e,n){this.__foltmeter__={data:[0,u[n][1]],range:t.ranges[n]},this._current=e,R.push(this.getTotalLength()),q.push(this)}),q.map(function(t,r){e=t.__foltmeter__,n=0===r?0:I[r-1]-R[r],a+=I[r]-R[r],e.svgData=[R[r],I[r]],e.evalData=[n,a],e.pointValue=O*((I[r]-R[r])/O)/e.data[1],e.minPointsAvailable=n*e.pointValue,e.maxPointsAvailable=e.pointValue*e.data[1]}),this.element=D[0][0]}function n(t,e){d(t)&&(P=t,F=t,B=e,T=0,p(),s(t,B))}function a(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return y(e(t))}}function r(){if(!window.d3)throw new Error("Foltmeter requires d3")}function o(t,e){var n,a=[];return t.map(function(t,r){n=e[r],a.push(x(n[0],h(t[0]),f(n[0],n[1],t[0],t[1])))}),a}function i(t,e){var n=[];return e.map(function(t){n.push([t[1],t[1]])}),o(t,n)}function u(t){var e=q[t].__foltmeter__.data,n=q[t].__foltmeter__.range;return[x(e[0],h(n[0]),f(e[0],e[1],n[0],n[1]))]}function l(t){if(1===Object.prototype.toString.call(t).indexOf("Object")||"undefined"==typeof t.selector||"undefined"==typeof t.colors||"undefined"==typeof t.radii||"undefined"==typeof t.data)throw new Error("Foltmeter requires a valid config object")}function d(t){return"string"==typeof t?/^(\d{1,})(\.)?(\d{1,})?$/g.test(t):!0}function s(){function e(t){var i,l;return z[t]?(i=z[t][0][0],l=i.__foltmeter__,o+=i.getTotalLength()-l.svgData[0],r+=l.svgData[1]-l.svgData[0],0===A&&o===r?void e(c(t)):0>A&&i.getTotalLength()-l.svgData[0]===0?void e(c(t)):void z[t].data(u(t)).transition().duration(n).ease("linear").each("end",function(){e(c(t))}).attrTween("d",a)):void 0}var n=B/t.ranges.length,r=0,o=0,i=0===w||w===q.length-1?q.length-w:q.length-w-1;e(E,!1),t.showPercentage&&L.data([P/O*100]).transition().duration(n*i).ease("linear").tween("text",function(t){var e=d3.interpolate(this.textContent,t);return function(t){this.textContent=Math.round(e(t))}})}function f(t,e,n,a){var r=t/e,o=Math.abs(n-a),i=o*r,u=n+i;return 1===r&&u!==a&&(u*=-1),h(u)}function c(t){return 0>A?t-1:t+1}function h(t){return t*(Math.PI/180)}function p(){var t;q.map(function(e){var n=e.__foltmeter__;t=n.data[1],F>t?(F-=t,n.points=n.pointValue*t,n.data[0]=t,T+=n.pointValue*n.data[0]):(n.points=n.pointValue*F,n.data[0]=F,F=0,T+=n.pointValue*n.data[0])}),g(),v(),m(),_()}function g(){var t=0;q.map(function(e,n){t+=e.getTotalLength()-e.__foltmeter__.svgData[0]}),j=t}function v(){A=j>T?-1:0}function _(){z=[],t.ranges.map(function(t,e){z.push(V.select("path:nth-child("+(e+1)+")"))}),E=this.direction<0?z.length-w:0+w}function m(){var t,e=j;w=0;for(var n=0;n<q.length;n++)if(t=q[n].__foltmeter__.evalData,e>t[0]&&e<=t[1]||0===e)return void(w=n)}function x(t,e,n){return{data:t,startAngle:e,endAngle:n,value:t}}var w,y,A,B,D,C,V,b,T,L,P,j=0,F=0,M=t.height||200,O=0,q=[],z=[],E=0,R=[],I=[],S=t.width||200;return e.prototype={set:n},new e}