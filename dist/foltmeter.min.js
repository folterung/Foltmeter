function Foltmeter(t){function e(){r(),l(t);var e,n=0,a=0,u=[];t.data.map(function(t){q+=t,u.push([0,t])}),B=d3.select(t.selector),B.selectAll("svg").remove(),y=d3.svg.arc().innerRadius(t.radii[0]).outerRadius(t.radii[1]),T=B.append("svg").attr("height",O).attr("width",S),V=T.append("g").attr("transform","translate("+S/2+","+O/2+")"),b=T.append("g").attr("transform","translate("+S/2+","+O/2+")"),t.showPercentage&&(P=T.append("text").attr("style","font-size: 20px; color: #455A64;").attr("dy","20px").text("0").attr("text-anchor","middle").attr("x",function(){return S/2-this.getBBox().width+3}).attr("y",function(){return O/2-this.getBBox().height/2}),T.append("text").attr("style","font-size: 20px; color: #455A64;").attr("dy","20px").text("%").attr("text-anchor","middle").attr("x",function(){return S/2+this.getBBox().width}).attr("y",function(){return O/2-this.getBBox().height/2})),V.selectAll("path").data(i(t.ranges,u)).enter().append("path").attr("fill",t.colors[0]).attr("d",y).each(function(){I.push(this.getTotalLength())}),b.selectAll("path").data(o(t.ranges,u)).enter().append("path").attr("fill",t.colors[1]).attr("d",y).each(function(e,n){this.__foltmeter__={data:u[n],range:t.ranges[n]},this._current=e,R.push(this.getTotalLength()),z.push(this)}),z.map(function(t,r){e=t.__foltmeter__,n=0===r?0:I[r-1]-R[r],a+=I[r]-R[r],e.svgData=[R[r],I[r]],e.evalData=[n,a],e.pointValue=q*((I[r]-R[r])/q)/e.data[1],e.minPointsAvailable=n*e.pointValue,e.maxPointsAvailable=e.pointValue*e.data[1]}),this.element=B[0][0]}function n(t,e){s(t)&&(j=t,M=t,A=e,L=0,p(),d(t,A))}function a(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return y(e(t))}}function r(){if(!window.d3)throw new Error("Foltmeter requires d3")}function o(t,e){var n,a=[];return t.map(function(t,r){n=e[r],a.push(x(n[0],h(t[0]),f(n[0],n[1],t[0],t[1])))}),a}function i(t,e){var n=[];return e.map(function(t){n.push([t[1],t[1]])}),o(t,n)}function u(t){var e=z[t].__foltmeter__.data,n=z[t].__foltmeter__.range;return[x(e[0],h(n[0]),f(e[0],e[1],n[0],n[1]))]}function l(t){if(1===Object.prototype.toString.call(t).indexOf("Object")||"undefined"==typeof t.selector||"undefined"==typeof t.colors||"undefined"==typeof t.radii||"undefined"==typeof t.data)throw new Error("Foltmeter requires a valid config object")}function s(t){return"string"==typeof t?/^(\d{1,})(\.)?(\d{1,})?$/g.test(t):!0}function d(){function e(t){var i,l;return C[t]?(i=C[t][0][0],l=i.__foltmeter__,o+=i.getTotalLength()-l.svgData[0],r+=l.svgData[1]-l.svgData[0],0===D&&o===r?void e(c(t)):0>D&&i.getTotalLength()-l.svgData[0]===0?void e(c(t)):void C[t].data(u(t)).transition().duration(n).ease("linear").each("end",function(){e(c(t))}).attrTween("d",a)):void 0}var n=A/t.ranges.length,r=0,o=0,i=0===w||w===z.length-1?z.length-w:z.length-w-1;e(E,!1),t.showPercentage&&P.data([j/q*100]).transition().duration(n*i).ease("linear").tween("text",function(t){var e=d3.interpolate(this.textContent,t);return function(t){this.textContent=Math.round(e(t))}})}function f(t,e,n,a){var r=t/e,o=Math.abs(n-a),i=o*r,u=n+i;return 1===r&&u!==a&&(u*=-1),h(u)}function c(t){return 0>D?t-1:t+1}function h(t){return t*(Math.PI/180)}function p(){var t;z.map(function(e){var n=e.__foltmeter__;t=n.data[1],M>t?(M-=t,n.points=n.pointValue*t,n.data[0]=t,L+=n.pointValue*n.data[0]):(n.points=n.pointValue*M,n.data[0]=M,M=0,L+=n.pointValue*n.data[0])}),g(),_(),m(),v()}function g(){var t=0,e=0;z.map(function(n,a){t+=n.getTotalLength()-n.__foltmeter__.svgData[0],e+=n.__foltmeter__.svgData[1]-n.__foltmeter__.svgData[0]}),F=t}function _(){D=F>L?-1:0}function v(){C=[],t.ranges.map(function(t,e){C.push(b.select("path:nth-child("+(e+1)+")"))}),E=this.direction<0?C.length-w:0+w}function m(){var t,e=F;w=0;for(var n=0;n<z.length;n++)if(t=z[n].__foltmeter__.evalData,e>t[0]&&e<=t[1]||0===e)return void(w=n)}function x(t,e,n){return{data:t,startAngle:e,endAngle:n,value:t}}var w,y,D,A,B,V,b,T,L,P,j,F=0,M=0,O=t.height||200,q=0,z=[],C=[],E=0,R=[],I=[],S=t.width||200;return e.prototype={set:n},new e}