function Foltmeter(t){function e(){r(),o(t);var e,n=0,a=0,l=[];t.data.map(function(t){O+=t,l.push([0,t])}),A=d3.select(t.selector),A.selectAll("svg").remove(),w=d3.svg.arc().innerRadius(t.radii[0]).outerRadius(t.radii[1]),b=A.append("svg").attr("height",M).attr("width",I),B=b.append("g").attr("transform","translate("+I/2+","+M/2+")"),V=b.append("g").attr("transform","translate("+I/2+","+M/2+")"),t.showPercentage&&(L=b.append("text").attr("style","font-size: 20px; color: #455A64;").attr("dy","20px").text("0").attr("text-anchor","middle").attr("x",function(){return I/2-this.getBBox().width+3}).attr("y",function(){return M/2-this.getBBox().height/2}),b.append("text").attr("style","font-size: 20px; color: #455A64;").attr("dy","20px").text("%").attr("text-anchor","middle").attr("x",function(){return I/2+this.getBBox().width}).attr("y",function(){return M/2-this.getBBox().height/2})),B.selectAll("path").data(u(t.ranges,l)).enter().append("path").attr("fill",t.colors[0]).attr("d",w).each(function(){R.push(this.getTotalLength())}),V.selectAll("path").data(i(t.ranges,l)).enter().append("path").attr("fill",t.colors[1]).attr("d",w).each(function(e,n){this.__foltmeter__={data:l[n],range:t.ranges[n]},this._current=e,E.push(this.getTotalLength()),q.push(this)}),q.map(function(t,r){e=t.__foltmeter__,n=0===r?0:R[r-1],a+=R[r]-E[r],e.svgData=[E[r],R[r]],e.evalData=[n,a],e.pointValue=O*((R[r]-E[r])/O)/e.data[1],e.minPointsAvailable=n*e.pointValue,e.maxPointsAvailable=e.pointValue*e.data[1]}),this.element=A[0][0]}function n(t,e){P=t,F=t,D=e,T=0,h(),s(t,D)}function a(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return w(e(t))}}function r(){if(!window.d3)throw new Error("Foltmeter requires d3")}function o(t){if(1===Object.prototype.toString.call(t).indexOf("Object")||"undefined"==typeof t.selector||"undefined"==typeof t.colors||"undefined"==typeof t.radii||"undefined"==typeof t.data)throw new Error("Foltmeter requires a valid config object")}function i(t,e){var n,a=[];return t.map(function(t,r){n=e[r],a.push(m(n[0],f(t[0]),d(n[0],n[1],t[0],t[1])))}),a}function u(t,e){var n=[];return e.map(function(t){n.push([t[1],t[1]])}),i(t,n)}function l(t){var e=q[t].__foltmeter__.data,n=q[t].__foltmeter__.range;return[m(e[0],f(n[0]),d(e[0],e[1],n[0],n[1]))]}function s(){function e(t){var i,u;return z[t]?(i=z[t][0][0],u=i.__foltmeter__,o+=i.getTotalLength()-u.svgData[0],r+=u.svgData[1]-u.svgData[0],0===y&&o===r?void e(c(t)):0>y&&i.getTotalLength()-u.svgData[0]===0?void e(c(t)):void z[t].data(l(t)).transition().duration(n).ease("linear").each("end",function(){e(c(t))}).attrTween("d",a)):void 0}var n=D/t.ranges.length,r=0,o=0,i=0===x||x===q.length-1?q.length-x:q.length-x-1;e(C,!1),t.showPercentage&&L.data([P/O*100]).transition().duration(n*i).ease("linear").tween("text",function(t){var e=d3.interpolate(this.textContent,t);return function(t){this.textContent=Math.round(e(t))}})}function d(t,e,n,a){var r=t/e,o=Math.abs(n-a),i=o*r,u=n+i;return 1===r&&u!==a&&(u*=-1),f(u)}function c(t){return 0>y?t-1:t+1}function f(t){return t*(Math.PI/180)}function h(){var t;q.map(function(e){var n=e.__foltmeter__;t=n.data[1],F>t?(F-=t,n.points=n.pointValue*t,n.data[0]=t,T+=n.pointValue*n.data[0]):(n.points=n.pointValue*F,n.data[0]=F,F=0,T+=n.pointValue*n.data[0])}),p(),g(),v(),_()}function p(){var t=0,e=0;q.map(function(n,a){t+=n.getTotalLength()-n.__foltmeter__.svgData[0],e+=n.__foltmeter__.svgData[1]-n.__foltmeter__.svgData[0]}),j=t}function g(){y=j>T?-1:0}function _(){z=[],t.ranges.map(function(t,e){z.push(V.select("path:nth-child("+(e+1)+")"))}),C=this.direction<0?z.length-x:0+x}function v(){var t,e=j;x=0;for(var n=0;n<q.length;n++)if(t=q[n].__foltmeter__.evalData,e>t[0]&&e<=t[1]||0===e)return void(x=n)}function m(t,e,n){return{data:t,startAngle:e,endAngle:n,value:t}}var x,w,y,D,A,B,V,b,T,L,P,j=0,F=0,M=t.height||200,O=0,q=[],z=[],C=0,E=[],R=[],I=t.width||200;return e.prototype={set:n},new e}